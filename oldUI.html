<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Epidemic watcher</title>
    <!--FAVICON-->
    <link rel="shortcut icon" href="favicon//favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon//favicon.ico" type="image/x-icon">
    <!--FAVICON-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" 
      href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" 
      integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" 
      crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/Date.format.min.js" ></script>
    <script src="js/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="css/bootstrap/bootstrap.css">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="js/bootstrap/bootstrap.js"></script>
    <link rel="stylesheet" href="css/animate.css" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js" integrity="sha256-8zyeSXm+yTvzUN1VgAOinFgaVFEFTyYzWShOy9w7WoQ=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.12/js/bootstrap-select.min.js"></script>
    
</head>
<body>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css" type="text/css" />
    <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <div class="input top">
        <div id="geocoder"></div>
        <div class="viewMenu">
            <div class="dropdown">
                <span data-toggle="dropdown" aria-haspopup="false" aria-expanded="false">&#9881;</span>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <div class="dropdown-item-text">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <p>Disease</p> 
                                </div>
                                <div class="col">
                                    <select name="disease" id="diseasesMenu" onchange="loadDiseases1(this.value)" class="custom-select"></select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dropdown-item-text">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <p>Graphs</p>
                                </div>
                                <div class="col">
                                    <button type="button" class="btn btn-dark btn-block" data-toggle="modal" data-target="#dashboardModal">Dashboard</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item-text text-center text-muted">View by TwoZer00 &copy; 2020 <br> Epidemic watcher 0.2</div>
                </div>
            </div>
        </div>
    </div>
    <div id='map'></div>
    <div class="input bottom" >
        <div class="row row-cols-1 no-gutters">
            <div class="col text-right">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#newsContainer" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
                    <img src="/css/bootstrap/bootstrap-icons-1.0.0-alpha4/three-dots.svg" alt="" width="32" height="32" title="News">
                </button>
            </div>
            <div class="col collapse show" id="newsContainer" >
                <div class="container-fluid">
                    <p class="text-muted">News</p>
                    <div class="card-deck" id="news" style="width: 100%; margin: auto;">
                    </div>
                </div>
            </div>
            <div class="w-100"></div>
            <div class="col">
                <div class="case hide" id="inputButton">
                    <button class="btn btn-dark btn-block" id="button">add case</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="formModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content animated bounceInDown fast">
            
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">New case</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger fade show" role="alert" id="alert" style="display: none;">
                    You need fill all the field
                </div>
                <div class="loader" id="loader"></div>
                <div class="check" id="check">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                    <p style="text-align: center;">Case added sucessfully</p>
                </div>
                <div id="content">
                    <form id="form" method="POST">
                        <div class="form-group">
                            <label for="first-name" class="col-form-label">First name:</label>
                            <input type="text" name="firstName" class="form-control" id="fisrt-name">
                            <label for="last-name" class="col-form-label">Last name:</label>
                            <input type="text" class="form-control" id="last-name" name="lastName">
                        </div>
                        <div class="row">
                            <div class="form-group col">
                                <label class="form-check-label">Gender</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="maleRadio" value="true">
                                    <label class="form-check-label" for="maleRadio">Male</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="gender" id="femaleRadio" value="false">
                                    <label class="form-check-label" for="femaleRadio">Female</label>
                                </div>
                            </div>
                            <div class="form-group col">
                                <label for="age">Age</label>
                                <input type="number" name="age" id="age" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <select class="selectpicker" name="disease" id="diseasesForm" data-live-search="true"  data-width="100%">
                                <option value="">Select the disease</option>
                            </select>
                            <div class="invalid-feedback">Example invalid custom select feedback</div>
                        </div>
                        <div class="form-group row">
                            <div class="col">
                                <label for="date">Date</label>
                            <input type="date" name="date" id="date" class="form-control">
                            </div>
                            <div class="col" id="geocoder">
                                <label for="geocoder">Adress</label>
                                <input type="text" class="form-control" disabled id="adress">
                            </div>
                            
                        </div>
                        <input type="text" name="latitude" id="lat" hidden>
                        <input type="text" name="longitude" id="lng" hidden>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="postCase()">Save case</button>
            </div>
        </div>
        </div>
    </div>
    <div class="modal" id="dashboardModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="dialog">
            <div class="modal-content animated bounceInDown fast">
                <div class="modal-header">
                    <h5 class="modal-title">Dashboard</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" >&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="dashForm">
                        <div class="form-group row">
                            <select class="selectpicker col" name="disease" id="diseasesDashboard" data-live-search="true" data-width="100%">
                                <option value="">Select the disease</option>
                            </select>
                            <div class="col">
                                <input type="date" class="form-control" id="datePicker">
                            </div>
                        </div>
                    </form>
                    <div class="invalid-feedback">Example invalid custom select feedback</div>
                    <canvas id="myChart" width="100%" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>
    <script>

        const api = 'https://damp-ravine-40090.herokuapp.com/api/diseases/';
        let clientLocation = [];
        var map;
        getLocation();

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else { 
                alert("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            clientLocation = [position.coords.longitude,position.coords.latitude];
            map.setCenter(clientLocation);
            
        }
        mapboxgl.center = clientLocation;
            mapboxgl.accessToken = 'pk.eyJ1IjoidHdvemVyMDAiLCJhIjoiY2s2NGRoamZ4MGphczNrcXA1NWw4dzN5MyJ9.-KxY1BPMApriPjGoMevTWg';
            map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/mapbox/light-v10',
                zoom:5
            });
        
        map.on('load', loadMap); 
        function loadMap() {
            // Add a geojson point source.
            // Heatmap layers also work with a vector tile source.
            var selected = document.getElementById("diseasesMenu").value;
            startNews(document.getElementById("diseasesMenu").value);
            map.addSource('diseases', {
            type: 'geojson',
            // Point to GeoJSON data. This example visualizes all M1.0+ earthquakes
            // from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.
            data:
            api + selected  ,
            cluster: true,
            clusterMaxZoom: 14, // Max zoom to cluster points on
            clusterRadius: 30 // Radius of each cluster when clustering points (defaults to 50)
            });
            map.
            map.addLayer({
                id: 'clusters',
                type: 'circle',
                source: 'diseases',
                filter: ['has', 'point_count'],
                paint: {
                    // Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)
                    // with three steps to implement three types of circles:
                    //   * Blue, 20px circles when point count is less than 100
                    //   * Yellow, 30px circles when point count is between 100 and 750
                    //   * Pink, 40px circles when point count is greater than or equal to 750
                    'circle-color': [
                        'step',
                        ['get', 'point_count'],
                        '#feda47',
                        100,
                        '#ff7800',
                        750,
                        '#ff0000'
                        ],
                        'circle-radius': [
                        'step',
                        ['get', 'point_count'],
                        20,
                        100,
                        30,
                        750,
                        40
                        ]
                }
                });
                
            map.addLayer({
                id: 'cluster-count',
                type: 'symbol',
                source: 'diseases',
                filter: ['has', 'point_count'],
                layout: {
                'text-field': '{point_count_abbreviated}',
                'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                'text-size': 12
                }
                });
                
            map.addLayer({
                id: 'unclustered-point',
                type: 'circle',
                source: 'diseases',
                filter: ['!', ['has', 'point_count']],
                paint: {
                'circle-color': '#ff0000',
                'circle-radius': 4,
                'circle-stroke-width': 1,
                'circle-stroke-color': '#fff'
                }
                });
            // inspect a cluster on click
            map.on('click', 'clusters', function(e) {
                    var features = map.queryRenderedFeatures(e.point, {
                    layers: ['clusters']
                    });
                    var clusterId = features[0].properties.cluster_id;
                    map.getSource('diseases').getClusterExpansionZoom(
                    clusterId,
                    function(err, zoom) {
                    if (err) return;
                    
                    map.easeTo({
                    center: features[0].geometry.coordinates,
                    zoom: zoom
                    });
                    }
                    );
                });    
            // When a click event occurs on a feature in
            // the unclustered-point layer, open a popup at
            // the location of the feature, with
            // description HTML from its properties.
            map.on('click', 'unclustered-point', function(e) {
                
                var coordinates = e.features[0].geometry.coordinates.slice();
                var mag = e.features[0].properties.mag;
                var tsunami;
                
                if (e.features[0].properties.tsunami === 1) {
                tsunami = 'yes'
                } else {
                tsunami = 'no'
                }
                
                // Ensure that if the map is zoomed out such that
                // multiple copies of the feature are visible, the
                // popup appears over the copy being pointed to.
                while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                }
                
                new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML("magnitude: " + mag + "<br>Was there a tsunami?: " + tsunami)
                .addTo(map);
                });
            map.on('mouseenter', 'clusters', function() {
                map.getCanvas().style.cursor = 'pointer';
                });
            map.on('mouseleave', 'clusters', function() {
            map.getCanvas().style.cursor = '';
            });
        }       
        
        var geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            Marker:{
                color:"black",
                draggable:true
            },
            mapboxgl: mapboxgl
        });
        geocoder.on('result',getCoor);
        function getCoor(){
            document.getElementById("lat").value = geocoder.mapMarker._lngLat.lat;
            document.getElementById("lng").value = geocoder.mapMarker._lngLat.lng;
        }
        var geocoderInput = document.getElementById('geocoder');
        geocoderInput.appendChild(geocoder.onAdd(map)).setAttribute("style","box-shadow:none;border:1px solid #ced4da;border-radius:0.25rem;min-width:0;width:100%;max-width:100%;");
    </script>

    <!-- <script>
        function loadMap(darkMode){
            mapboxgl.accessToken = 'pk.eyJ1IjoidHdvemVyMDAiLCJhIjoiY2s2NGRoamZ4MGphczNrcXA1NWw4dzN5MyJ9.-KxY1BPMApriPjGoMevTWg';
        if (darkMode){
                var map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/mapbox/light-v10',
                center: clientLocation, // starting position
                zoom:3
            });
            
            map.on('load', loadMap); 
            function loadMap() {
                // Add a geojson point source.
                // Heatmap layers also work with a vector tile source.
                var selected = document.getElementById("diseasesMenu").value;
                map.addSource('diseases', {
                type: 'geojson',
                // Point to GeoJSON data. This example visualizes all M1.0+ earthquakes
                // from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.
                data:
                'http://54.211.232.101:8080/api/diseases/' + selected  ,
                cluster: true,
                clusterMaxZoom: 14, // Max zoom to cluster points on
                clusterRadius: 30 // Radius of each cluster when clustering points (defaults to 50)
                });

                map.addLayer({
                    id: 'clusters',
                    type: 'circle',
                    source: 'diseases',
                    filter: ['has', 'point_count'],
                    paint: {
                        // Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)
                        // with three steps to implement three types of circles:
                        //   * Blue, 20px circles when point count is less than 100
                        //   * Yellow, 30px circles when point count is between 100 and 750
                        //   * Pink, 40px circles when point count is greater than or equal to 750
                        'circle-color': [
                            'step',
                            ['get', 'point_count'],
                            '#feda47',
                            100,
                            '#ff7800',
                            750,
                            '#ff0000'
                            ],
                            'circle-radius': [
                            'step',
                            ['get', 'point_count'],
                            20,
                            100,
                            30,
                            750,
                            40
                            ]
                    }
                    });
                    
                map.addLayer({
                    id: 'cluster-count',
                    type: 'symbol',
                    source: 'diseases',
                    filter: ['has', 'point_count'],
                    layout: {
                    'text-field': '{point_count_abbreviated}',
                    'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-size': 12
                    }
                    });
                    
                map.addLayer({
                    id: 'unclustered-point',
                    type: 'circle',
                    source: 'diseases',
                    filter: ['!', ['has', 'point_count']],
                    paint: {
                    'circle-color': '#ff0000',
                    'circle-radius': 4,
                    'circle-stroke-width': 1,
                    'circle-stroke-color': '#fff'
                    }
                    });
                // inspect a cluster on click
                map.on('click', 'clusters', function(e) {
                        var features = map.queryRenderedFeatures(e.point, {
                        layers: ['clusters']
                        });
                        var clusterId = features[0].properties.cluster_id;
                        map.getSource('diseases').getClusterExpansionZoom(
                        clusterId,
                        function(err, zoom) {
                        if (err) return;
                        
                        map.easeTo({
                        center: features[0].geometry.coordinates,
                        zoom: zoom
                        });
                        }
                        );
                    });    
                // When a click event occurs on a feature in
                // the unclustered-point layer, open a popup at
                // the location of the feature, with
                // description HTML from its properties.
                map.on('click', 'unclustered-point', function(e) {
                    
                    var coordinates = e.features[0].geometry.coordinates.slice();
                    var mag = e.features[0].properties.mag;
                    var tsunami;
                    
                    if (e.features[0].properties.tsunami === 1) {
                    tsunami = 'yes'
                    } else {
                    tsunami = 'no'
                    }
                    
                    // Ensure that if the map is zoomed out such that
                    // multiple copies of the feature are visible, the
                    // popup appears over the copy being pointed to.
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                    
                    new mapboxgl.Popup()
                    .setLngLat(coordinates)
                    .setHTML("magnitude: " + mag + "<br>Was there a tsunami?: " + tsunami)
                    .addTo(map);
                    });
                map.on('mouseenter', 'clusters', function() {
                    map.getCanvas().style.cursor = 'pointer';
                    });
                map.on('mouseleave', 'clusters', function() {
                map.getCanvas().style.cursor = '';
                });
            }       
            
            var geocoder = new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                Marker:{
                    color:"black",
                    draggable:true
                },
                mapboxgl: mapboxgl
            });
            geocoder.on('result',getCoor);
            function getCoor(){
                document.getElementById("lat").value = geocoder.mapMarker._lngLat.lat;
                document.getElementById("lng").value = geocoder.mapMarker._lngLat.lng;
            }
            var geocoderInput = document.getElementById('geocoder');
            geocoderInput.appendChild(geocoder.onAdd(map)).setAttribute("style","box-shadow:none;border:1px solid #ced4da;border-radius:0.25rem;min-width:0;width:100%;max-width:100%;");
            }
        }
    </script> -->
    <script>
        loadDiseases();
        var datepicker = document.getElementById("datePicker");
        datepicker.setAttribute("max",new Date().format('Y-m-d'));
        $('input, label, select, p').on('click', function(e){
            e.stopPropagation();
        });
        function loadDiseases(){
            var xhttp = new XMLHttpRequest();
            var responseJson;
            
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    loadSelects(this);
                    $('.selectpicker').selectpicker('refresh');
                }
            };
            xhttp.open("GET", "http://54.211.232.101:8080/api/diseases/", true);
            xhttp.send();
        }
        function loadSelects(json){
            responseJson = JSON.parse(json.responseText);
            JsonToSelect(responseJson,document.getElementById("diseasesMenu"),true);
            JsonToSelect(responseJson,document.getElementById("diseasesForm"));
            JsonToSelect(responseJson,document.getElementById("diseasesDashboard"),true);
        }
        function JsonToSelect(json,select,random){
            var selected = Math.floor((Math.random() * json.length));
            if (random!=undefined){
                for(var i=0;i<json.length; i++){
                    var option = document.createElement("option");
                    option.text = json[i];
                    option.value = json[i];
                    if(selected === i){
                        option.selected = "selected";
                        console.log(option.text);
                    }
                    select.options.add(option);
                }
            }
            else{
                var diseases = ["HIV","CHOLERA(HISPANIOLA)","CHOLERA(YEMEN)","EBOLA","HFMD","MEASLES(CONGO)","MEASLES(SAMOA)","MERS"];
                var optGroupJson = document.createElement("optgroup");
                optGroupJson.setAttribute("label","Registered");
                var optGroupText = document.createElement("optgroup");
                optGroupText.setAttribute("label", "No registered");
                select.appendChild(optGroupJson);
                select.appendChild(optGroupText);
                for(var i=0;i<json.length;i++){
                    var option = document.createElement("option");
                    option.text = json[i];
                    option.value = json[i];
                    optGroupJson.appendChild(option);
                }
                for(var i=0;i<diseases.length;i++){
                    var option = document.createElement("option");
                    option.text = diseases[i];
                    option.value = diseases[i];
                    optGroupText.appendChild(option);
                    console.log(diseases[i]);
                }
            }
        }

    </script>

    <script>
        function postCase(){
            var form = document.getElementById("form");
            var formData = new FormData(form);
            var object = {};
            formData.forEach((value, key) => {object[key] = value});
            var validator=true;
            for (var key in object) {
                if (object.hasOwnProperty(key)) {
                    var val = object[key];
                    if(key==="latitude" && val===""){
                        validator=false;
                    }
                    if(key==="disease" && val ===""){
                        validator=false;
                    }
                }
            }
            if(validator){
                document.getElementById("loader").style.display = "block";
                document.getElementById("content").style.display = "none";
                var json = JSON.stringify(object);
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 201) {
                        document.getElementById("form").reset();
                        document.getElementById("loader").style.display = "none";
                        document.getElementById("check").style.display = "block";
                        setTimeout(function(){
                            document.getElementById("content").style.display = "block";
                            document.getElementById("check").style.display = "none";
                            $('#formModal').modal('hide');
                            geocoder._removeMarker();
                        },1500);
                    }
                };
                xhttp.open("POST", "http://54.211.232.101:8080/case", true);
                xhttp.setRequestHeader('Content-type', 'application/json');
                xhttp.send(json);
            }
            else{
                document.getElementById("alert").style.display = "block";
                setTimeout(function(){
                    $("#alert").alert('close');
                },3000);
            }
        }
    </script>
    <script>
        /*var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 201) {
                createGraph(JSON.parse(this.responseText));
            }
        };
        xhttp.open("POST", "http://54.211.232.101:8080/case", true);
        xhttp.setRequestHeader('Content-type', 'application/json');
        xhttp.send(json);*/

        var json = {"disease": "COVID_19", "date": "2020-03-05", "forecast": [[1911.5736842155457, "2020-01-29"], [2138.894736856222, "2020-01-30"], [2366.2157894670963, "2020-01-31"], [2593.536842107773, "2020-02-01"], [2820.8578947484493, "2020-02-02"], [3048.1789473593235, "2020-02-03"], [3275.5, "2020-02-04"], [3502.8210526406765, "2020-02-05"], [3730.1421052515507, "2020-02-06"], [3957.463157892227, "2020-02-07"], [4184.784210532904, "2020-02-08"], [4412.10526317358, "2020-02-09"], [4639.426315784454, "2020-02-10"], [4866.747368425131, "2020-02-11"], [5094.068421065807, "2020-02-12"], [5321.3894736766815, "2020-02-13"], [5548.710526317358, "2020-02-14"], [5776.0315789580345, "2020-02-15"], [6003.352631568909, "2020-02-16"], [6230.673684209585, "2020-02-17"], [6457.994736850262, "2020-02-18"], [6685.315789461136, "2020-02-19"], [6912.636842101812, "2020-02-20"], [7139.957894742489, "2020-02-21"], [7367.278947383165, "2020-02-22"], [7594.5999999940395, "2020-02-23"], [7821.921052634716, "2020-02-24"], [8049.2421052753925, "2020-02-25"], [8276.563157886267, "2020-02-26"], [8503.884210526943, "2020-02-27"], [8731.20526316762, "2020-02-28"], [8958.526315778494, "2020-02-29"], [9185.84736841917, "2020-03-01"], [9413.168421059847, "2020-03-02"], [9640.489473700523, "2020-03-03"], [9867.810526311398, "2020-03-04"], [10095.131578952074, "2020-03-05"], [10322.45263159275, "2020-03-06"], [10549.773684203625, "2020-03-07"], [10777.094736844301, "2020-03-08"], [11004.415789484978, "2020-03-09"], [11231.736842095852, "2020-03-10"], [11459.057894736528, "2020-03-11"], [11686.378947377205, "2020-03-12"], [11913.699999988079, "2020-03-13"], [12141.021052628756, "2020-03-14"], [12368.342105269432, "2020-03-15"], [12595.663157910109, "2020-03-16"], [12822.984210520983, "2020-03-17"], [13050.30526316166, "2020-03-18"], [13277.626315802336, "2020-03-19"], [13504.94736841321, "2020-03-20"], [13732.268421053886, "2020-03-21"], [13959.589473694563, "2020-03-22"], [14186.910526305437, "2020-03-23"], [14414.231578946114, "2020-03-24"], [14641.55263158679, "2020-03-25"], [14868.873684227467, "2020-03-26"], [15096.19473683834, "2020-03-27"], [15323.515789479017, "2020-03-28"], [15550.836842119694, "2020-03-29"], [15778.157894730568, "2020-03-30"], [16005.478947371244, "2020-03-31"], [16232.800000011921, "2020-04-01"], [16460.121052622795, "2020-04-02"], [16687.44210526347, "2020-04-03"], [16914.763157904148, "2020-04-04"]], "data": [[1725, "2020-01-29"], [1679, "2020-01-27"], [1073, "2020-01-25"], [1584, "2020-01-28"], [780, "2020-01-26"], [452, "2020-01-30"], [287, "2020-01-24"], [3771, "2020-02-04"], [402, "2020-01-21"], [79, "2020-02-05"], [225, "2020-01-22"], [2987, "2020-02-08"], [99, "2020-01-23"], [1693, "2020-01-31"], [2904, "2020-02-02"], [7367, "2020-02-01"], [4305, "2020-02-03"], [6566, "2020-02-06"], [2661, "2020-02-07"]]};
        
        //function createGraph(json){
            var forecast = json.forecast;
            var dataset = json.data;
            var labels = [];
            var data = [];
            var labels1 = [];
            var data1 = [];
            //var labbels = arrayUnique(labels.concat(labels1));
            var newData1=[];
            for (var key in forecast) {
                var newObj = forecast[key];
                
                var jsonObj = {x: new Date(newObj[1]), y: newObj[0]};
                newData1.push(jsonObj);
            }

            console.log(newData1[0].x);
            var newData=[];
            for(var key in dataset){
                var newObj = dataset[key];
                console.log(typeof(newObj[1]));
                var jsonObj = {x: new Date(newObj[1]), y: newObj[0]};
                newData.push(jsonObj);
            }
            console.log(newData[0].x + " " + newData1[0].x);
            var ctx = document.getElementById('myChart');
            var scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Scatter Dataset',
                        pointBackgroundColor:'rgba(0, 0, 0, 1)',
                        data: newData,
                        order:2
                    },{
                        label:'forecast',
                        type:'line',
                        data: newData1,
                        pointRadius:0,
                        fill:false,
                        borderColor:'rgba(255,0,0,0.5)',
                        order:1
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            id: 'first-y-axis',
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            bounds:'data'
                        }]
                    }
                }
            });
        //}
    </script>
    
    <script>
        function darkMode(value){
            if(value.checked){
                enableDarkMode();
            }
            else{
                disableDarkMode();
            }
        }
        function enableDarkMode(){
            map.setStyle('mapbox://styles/mapbox/dark-v10');
            document.getElementsByClassName("viewMenu")[0].style.color = "white";
        }
        function disableDarkMode(){
            map.setStyle('mapbox://styles/mapbox/light-v10');
            document.getElementsByClassName("viewMenu")[0].style.color = "black";
        }

    </script>

    <script>
        function loadDiseases1 (select){
            map.getSource("diseases").setData("http://54.211.232.101:8080/api/diseases/" + select);
        }
    </script>
    <script>
        geocoder.on('result',function(){
            document.getElementById("inputButton").classList.remove("hide");
            $('#inputButton').addClass('animated bounceInUp');
            document.getElementById("button").onclick = function(){
                $('#formModal').modal('show');
            };
            document.getElementById("adress").value = geocoder._typeahead.selected.place_name;
            document.getElementById("newsContainer").style.visibility = "hidden";
        });
        document.getElementsByClassName("mapboxgl-ctrl-geocoder--button")[0].onclick = function(){
            document.getElementById("inputButton").classList.add("hide");
            document.getElementById("newsContainer").style.visibility = "visible";
        };
    </script>
    <script>
        const colorThief = new ColorThief();
        function startNews(disease){
            var xhttp = new XMLHttpRequest();
            var responseJson;
            xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        if(screen.width<1700){
                            mobileNews(this.response);
                        }
                        else{
                            loadNews(this.response);
                        }
                    }
                };

            var country="";
            $.getJSON('https://ipinfo.io?token=bf29a8e8386eec', function(data){
                country="&country="+data.country;
                xhttp.open("GET", "https://newsapi.org/v2/top-headlines?apiKey=ef6ce5b0b23e42b1ba5edbd1b3705145"+"&q="+switchWord(disease)+country, true);
                xhttp.send();
            });
        }
        function switchWord(word){
            if("COVID_19"){
                return  "covid";    
            }
        }
        function loadNews(response){
            var articles = JSON.parse(response).articles;
            var size=articles.length;
            var width;
            if(articles.length>5){
                width="100%";
                size = 5;
            }
            else if(articles.length<5){
                width="300px";
            }
            for(var i=0;i<size;i++){
                
                var article = articles[i];
                var elem = document.createElement("div");
                elem.classList.add("card");
                
                elem.classList.add("text-white");

                elem.classList.add("text-justify");
                elem.style.maxWidth = width;
                var imgColor= [0,0,0];
                if(article.urlToImage!==null){
                    var img = document.createElement("img");
                    img.classList.add("car-img");
                    img.src = article.urlToImage;
                    img.style.width = "100%";
                    img.style.height = "100%";
                    elem.appendChild(img);
                }
                else{
                    elem.style.backgroundColor = "black";
                }
                var carBody = document.createElement("div");
                carBody.classList.add("card-img-overlay");
                var text = document.createElement("h5");
                //var p = document.createElement("p");
                var btn = document.createElement("a");
                btn.classList.add("btn");
                
                //p.classList.add("card-text");
                //p.innerText = article.description;
                text.classList.add("card-tittle");
                text.innerText = article.title;
                text.style.textShadow = "2px 2px 4px #000000";
                //carBody.appendChild(p);
                
                carBody.appendChild(text);
                btn.href = article.url;
                btn.innerText = "see more";
                btn.target = "_blank";
                
                
                if (img.complete) {
                    imgColor = colorThief.getColor(img);
                } else {
                img.addEventListener('load', function() {
                    imgColor = colorThief.getColor(img);
                });
                }
                
                carBody.appendChild(btn);
                elem.appendChild(carBody);
                //btn.style.color=invertColor(rgbToHex(imgColor[0],imgColor[1],imgColor[2]),true);
                btn.style.backgroundColor= rgb(imgColor)
                btn.style.color=invertColor(rgbToHex(imgColor[0],imgColor[1],imgColor[2]),true);
                //elem.style.backgroundColor = rgb(imgColor);
                document.getElementById("news").appendChild(elem);
            }
        }
        function rgb(values) {
            return 'rgb(' + values.join(', ') + ')';
        }
        function mobileNews(response){
            document.getElementById("news").remove();
            var articles = JSON.parse(response).articles;
            var size=articles.length;
            if(articles.length>3){
                size = 3;
            }
            var ul = document.createElement("ul");
            ul.classList.add("list-group");
            ul.classList.add("list-group-horizontal");
            ul.style.margin = "0px 15px";
            for(var i=0;i<size;i++){
                var article = articles[i];
                var li = document.createElement("li");
                var btn = document.createElement("a");
                li.classList.add("list-group-item");
                //li.innerText=article.title;
                btn.innerText = article.title;
                btn.href = article.url;
                btn.target = "_blank";
                btn.classList.add("text-decoration-none");
                btn.style.color = "black";
                var dt = document.createAttribute("data-toggle");
                dt.value = "tooltip";
                var dc = document.createAttribute("title");
                dc.value = "click to see more info.";
                var trigger = document.createAttribute("data-trigger");
                trigger.value = "manual";
                
                li.setAttributeNode(dt);
                li.setAttributeNode(dc);
                li.setAttributeNode(trigger);
                li.appendChild(btn);
                li.style.fontSize = "12px";
                li.style.overflow ="scroll"
                li.style.maxHeight = "80px";

                ul.appendChild(li);
            }
            $('li').tooltip('show');
            document.getElementById("newsContainer").appendChild(ul);
        }
        function invertColor(hex, bw) {
            if (hex.indexOf('#') === 0) {
                hex = hex.slice(1);
            }
            // convert 3-digit hex to 6-digits.
            if (hex.length === 3) {
                hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
            }
            if (hex.length !== 6) {
                throw new Error('Invalid HEX color.');
            }
            var r = parseInt(hex.slice(0, 2), 16),
                g = parseInt(hex.slice(2, 4), 16),
                b = parseInt(hex.slice(4, 6), 16);
            if (bw) {
                // http://stackoverflow.com/a/3943023/112731
                return (r * 0.299 + g * 0.587 + b * 0.114) > 186
                    ? '#000000'
                    : '#FFFFFF';
            }
            // invert color components
            r = (255 - r).toString(16);
            g = (255 - g).toString(16);
            b = (255 - b).toString(16);
            // pad each with zeros and return
            return "#" + padZero(r) + padZero(g) + padZero(b);
        }
        function componentToHex(c) {
        var hex = c.toString(16);
        return hex.length == 1 ? "0" + hex : hex;
        }
        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }
        
    </script>
</body>
</html>